MFWEB_DIR = '../lib/'
$: << MFWEB_DIR << 'lib'
require 'mfweb/core'
require 'mfweb/article'
verbose(true)

BUILD_DIR = 'build/'
CSS_PATHS = %w[css ../css]

require 'sampleSite'
Mfweb::Core::Site.init(SampleSite.new)

task :default => [:clobber, :articles]

require 'rake/clean'
CLOBBER.include BUILD_DIR


desc "build articles"
task :articles
sassTask '../css/article.scss', 'articles', :articles
build_simple_articles(Mfweb::Core::Site.skeleton.with_css('article.css'))

FileList['articles/flexible/flexible-article.xml'].each do |src|
	target = File.join(BUILD_DIR + 'articles', 'flexible.html')
	file target => [src] do
    skeleton = Mfweb::Core::Site.skeleton.with_css('flexible.css')
		maker = Mfweb::Article::ArticleMaker.new(src, target, skeleton)
    # need to set up the demonstration of these
    #maker.bib_server = Bibliography.new 'bib.xml'
		#maker.code_server = CodeServer.new 'articles/mock/'
    maker.run
	end
	task :articles => target
  sassTask 'articles/flexible/flexible.scss', 'articles', :articles
end











task :diff do
  cd "../mfweb"
  Dir['*.rb'].each do |f|
    system "diff -q #{f} ~/active/web/lib/#{f.pathmap('%f')}"
  end
end
